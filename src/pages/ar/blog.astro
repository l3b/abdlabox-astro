---
// src/pages/ar/blog.astro - Styled Version 6 (Near Black H1)
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import { normalizeTag } from '../../data/tags';
import OptimizedImage from '../../components/OptimizedImage.astro';

// 1. Fetch Arabic posts, filter drafts
const allArabicPosts = await getCollection('blog', ({ data }) => {
  return data.language === 'ar' && data.isDraft !== true;
});

// 2. Sort posts by date
const sortedPosts = allArabicPosts.sort(
  (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf()
);

const pageTitle = "المدونة";
const pageDescription = "أحدث المقالات والأفكار حول التكنولوجيا، إدارة المعرفة، الجري، والمزيد.";
---
<BaseLayout title={pageTitle} description={pageDescription} lang="ar" dir="rtl">
  {/* Centered container with vertical padding */}
  <div class="container mx-auto px-4 py-8 md:px-6 md:py-12">

    {/* Page Title - Near Black text, Neon Yellow bottom border */}
    <h1 class="inline-block text-3xl md:text-4xl font-bold mb-4 text-soft-charcoal pb-2 border-b-2 border-b-neon-yellow">{pageTitle}</h1>
    <p class="text-lg text-gray-600 mb-10 md:mb-12">{pageDescription}</p>

    {/* List of Blog Posts */}
    <div class="space-y-8 md:space-y-10">
      {sortedPosts.map(post => (
        <article class="card relative overflow-hidden">
          <div class="flex flex-col md:flex-row gap-4">
            {post.data.featuredImage && (
              <div class="w-full md:w-1/4 md:max-w-[200px] md:pt-[5%]">
                {post.data.featuredImage.r2Path ? (
                  <OptimizedImage 
                    src={`r2://${post.data.featuredImage.r2Path}`}
                    alt={post.data.featuredImage.alt || `صورة توضيحية لـ ${post.data.title}`}
                    width={200}
                    height={128}
                    class="w-full h-48 md:h-32 rounded-lg object-cover shadow-sm"
                  />
                ) : (
                  <img 
                    src={post.data.featuredImage.url} 
                    alt={post.data.featuredImage.alt || `صورة توضيحية لـ ${post.data.title}`} 
                    class="w-full h-48 md:h-32 rounded-lg object-cover shadow-sm"
                  />
                )}
              </div>
            )}
            <div class="flex-1">
          <a href={`/ar/blog/${post.slug.replace(/^ar\//, '')}`}
             class="block mb-2 no-underline"
          >
            <h2 class="text-xl md:text-2xl font-semibold text-electric-blue hover:text-teal-600 hover:underline transition-colors duration-200">
              {post.data.title}
            </h2>
          </a>

          {/* Post Metadata */}
          <div class="text-sm text-gray-600 mb-3 flex flex-wrap items-center gap-x-4 gap-y-1">
            <span>
              نُشر في: {post.data.pubDate.toLocaleDateString('ar-SA', { year: 'numeric', month: 'long', day: 'numeric' })}
            </span>
            {post.data.tags && post.data.tags.length > 0 && (
              <span>
                تصنيفات:
                {post.data.tags?.map(tag => (
                <a 
                  href={`/ar/tags/${normalizeTag(tag)}`}
                  class="tag"
                >
                  {tag}
                </a>
              ))}
              </span>
            )}
          </div>

          {/* Post Description */}
          {post.data.description && (
            <p class="text-gray-700 leading-relaxed mt-2">
              {post.data.description}
            </p>
          )}

          {/* Read More Link - Teal underline default */}
          <a
             href={`/ar/blog/${post.slug.replace(/^ar\//, '')}`}
             class="inline-block mt-4 text-teal-600 font-medium underline decoration-teal-600 hover:text-neon-yellow hover:decoration-neon-yellow transition-colors duration-200"
          >
             اقرأ المزيد &larr;
          </a>
        </article>
      ))}
    </div> {/* End space-y div */}
  </div> {/* End container div */}
</BaseLayout>
```